<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clue Game - Web Version</title>
    <style>
        body {
            background: #000;
            color: #00FF00;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            font-size: 14px;
        }
        
        .terminal {
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .output {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            white-space: pre-wrap;
            line-height: 1.4;
            border: 1px solid #333;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 4px;
        }
        
        .btn {
            background: #00FF00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #00CC00;
            transform: translateY(-1px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-btn {
            background: #333;
            color: #00FF00;
            border: 1px solid #555;
            padding: 8px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-btn:hover {
            background: #444;
            border-color: #00FF00;
        }
        
        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #111;
            border: 1px solid #444;
            padding: 15px;
            border-radius: 4px;
        }
        
        .info-box h3 {
            margin: 0 0 10px 0;
            color: #FFA500;
            font-size: 16px;
        }
        
        .suspect { color: #FF00FF; font-weight: bold; }
        .weapon { color: #FFA500; font-weight: bold; }
        .room { color: #00FFFF; font-weight: bold; }
        .player { color: #00FF00; font-weight: bold; }
        .ai { color: #FF0000; font-weight: bold; }
        
        .version-info {
            text-align: center;
            margin-bottom: 20px;
            color: #888;
            font-size: 12px;
        }
        
        @media (max-width: 600px) {
            body { padding: 10px; font-size: 12px; }
            .controls { grid-template-columns: 1fr 1fr; }
            .game-info { grid-template-columns: 1fr; }
            .output { height: 250px; }
            .modal-content { width: 95%; height: 80%; }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            overflow: auto;
        }
        
        .modal-content {
            background: #1a1a1a;
            border: 2px solid #00FF00;
            border-radius: 8px;
            padding: 20px;
            margin: 50px auto;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #00FF00;
        }
        
        .close-btn {
            background: #FF0000;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
        }
        
        .close-btn:hover {
            background: #CC0000;
        }
        
        .modal-body {
            color: #ccc;
            line-height: 1.6;
        }
        
        .modal-body h4 {
            color: #FFA500;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        
        .modal-body p, .modal-body ul {
            margin-bottom: 15px;
        }
        
        .modal-body li {
            margin-left: 20px;
            margin-bottom: 5px;
        }
        
        #notes-area {
            width: 100%;
            background: #111;
            border: 1px solid #444;
            color: #ccc;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-radius: 4px;
            resize: vertical;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #FFA500;
            font-weight: bold;
        }
        
        .form-group select {
            width: 100%;
            background: #111;
            border: 1px solid #444;
            color: #ccc;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .form-group select:focus {
            outline: none;
            border-color: #00FF00;
        }
        
        .suggestion-form, .accusation-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .checklist-section {
            margin-bottom: 20px;
        }
        
        .checklist-section h5 {
            color: #FFA500;
            margin-bottom: 10px;
            margin-top: 15px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .checklist-item label {
            color: #ccc;
            cursor: pointer;
        }
        
        .checklist-item label.suspect {
            color: #FF00FF;
        }
        
        .checklist-item label.weapon {
            color: #FFA500;
        }
        
        .checklist-item label.room {
            color: #00FFFF;
        }
        
        .disproval-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .disproval-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .disproval-card-option {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #111;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .disproval-card-option:hover {
            background: #222;
            border-color: #00FF00;
        }
        
        .disproval-card-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .disproval-card-option label {
            cursor: pointer;
            font-weight: bold;
        }
        
        .disproval-card-option.suspect label {
            color: #FF00FF;
        }
        
        .disproval-card-option.weapon label {
            color: #FFA500;
        }
        
        .disproval-card-option.room label {
            color: #00FFFF;
        }
        
        .main-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .menu-content {
            background: #0f3460;
            border: 2px solid #00FF00;
            border-radius: 10px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .menu-content h1 {
            color: #00FF00;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }
        
        .menu-subtitle {
            color: #00FFFF;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .menu-options {
            margin: 30px 0;
        }
        
        .option-group {
            margin: 20px 0;
            text-align: left;
        }
        
        .option-group label {
            color: #00FF00;
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
        }
        
        .option-group select {
            width: 100%;
            padding: 10px;
            background: #1a1a2e;
            border: 1px solid #00FF00;
            border-radius: 5px;
            color: #FFFFFF;
            font-size: 16px;
        }
        
        .option-group select:focus {
            outline: none;
            border-color: #00FFFF;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }
        
        .menu-btn {
            background: #00FF00;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .menu-btn:hover {
            background: #00FFFF;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }
        
        .menu-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #00FF00;
        }
        
        .menu-footer p {
            color: #888;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .game-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .game-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .game-info {
            flex: 1;
            color: #00FFFF;
        }
        
        .load-btn {
            background: #00FF00;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .load-btn:hover {
            background: #00FFFF;
            color: #000;
        }
        
        .game-actions {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .delete-btn {
            background: #FF4444;
            color: #FFFFFF;
            border: none;
            padding: 6px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #FF6666;
        }
        
        .cancel-btn {
            background: #FF0000;
            color: #FFFFFF;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .action-row {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            justify-content: space-between;
        }
        
        .action-row .quick-btn {
            flex: 1;
            font-size: 11px;
            padding: 6px 2px;
            min-width: 0;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .footer-controls {
            display: flex;
            flex-direction: row;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }
    </style>
</head>
<body>
    <!-- Main Menu -->
    <div id="main-menu" class="main-menu">
        <div class="menu-content">
            <h1>üïµÔ∏è‚Äç‚ôÄÔ∏è Clue Detective Game</h1>
            <p class="menu-subtitle">Solve the mystery of who committed the crime!</p>
            
            <div class="menu-options">
                <div class="option-group">
                    <label for="player-count">Number of Players:</label>
                    <select id="player-count">
                        <option value="2">2 Players (You + 1 AI)</option>
                        <option value="3" selected>3 Players (You + 2 AI)</option>
                        <option value="4">4 Players (You + 3 AI)</option>
                        <option value="5">5 Players (You + 4 AI)</option>
                        <option value="6">6 Players (You + 5 AI)</option>
                    </select>
                </div>
                
                <div class="option-group">
                    <label for="difficulty">AI Difficulty:</label>
                    <select id="difficulty">
                        <option value="Easy">Easy - Beginner Detective</option>
                        <option value="Medium" selected>Medium - Skilled Investigator</option>
                        <option value="Hard">Hard - Master Detective</option>
                    </select>
                </div>
                
                <button class="menu-btn" onclick="startNewGame()">üéÆ Start New Game</button>
            </div>
            
            <div class="menu-footer">
                <p>Based on the classic 1949 Clue board game</p>
                <p>Use logic and deduction to solve the mystery!</p>
            </div>
        </div>
    </div>
    
    <!-- Game Interface -->
    <div id="game-interface" class="terminal" style="display: none;">
        <div class="version-info">
            Clue Game Web Version | <span id="current-version">Loading...</span>
        </div>
        
        <div class="game-info">
            <div class="info-box">
                <h3>Game Status</h3>
                <div>Game ID: <span id="game-id">New Game</span></div>
                <div>Turn: <span id="turn-status">Your Turn</span></div>
                <div>Location: <span id="location">-</span></div>
            </div>
            <div class="info-box">
                <h3>Quick Actions</h3>
                <div class="quick-actions">
                    <div class="action-row">
                        <button class="quick-btn" onclick="showMove()">Move</button>
                        <button class="quick-btn" onclick="showSuggestion()">Suggest</button>
                        <button class="quick-btn" onclick="showAccusation()">Accuse</button>
                    </div>
                    <div class="action-row">
                        <button class="quick-btn" onclick="showMap()">Map</button>
                        <button class="quick-btn" onclick="showNotebook()">Notebook</button>
                        <button class="quick-btn" onclick="showPlayers()">Players</button>
                    </div>
                    <div class="action-row">
                        <button class="quick-btn" onclick="showRules()">üìñ Rules</button>
                        <button class="quick-btn" onclick="sendCommand('space')">üîÑ End Turn</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="output" id="game-output">
Loading Clue Game...
            </div>
        </div>
        
        <!-- Modal Views -->
        <div id="map-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üó∫Ô∏è Mansion Map</h3>
                    <button class="close-btn" onclick="closeModal('map-modal')">√ó</button>
                </div>
                <div class="modal-body" id="map-content">
                    Map loading...
                </div>
            </div>
        </div>
        
        <div id="rules-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìñ Game Rules</h3>
                    <button class="close-btn" onclick="closeModal('rules-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <h4>OBJECTIVE:</h4>
                    <p>Determine who committed the murder, with what weapon, and in which room.</p>
                    
                    <h4>GAMEPLAY:</h4>
                    <ul>
                        <li>Move between rooms by selecting 'Move to Room'</li>
                        <li>When in a room, make a suggestion about the crime</li>
                        <li>Other players must disprove suggestions if possible</li>
                        <li>Make a final accusation when ready</li>
                    </ul>
                    
                    <h4>WINNING:</h4>
                    <p>Correctly accuse the murderer, weapon, and location</p>
                    <p>Wrong accusation means you lose the game!</p>
                    
                    <h4>STRATEGY TIPS:</h4>
                    <ul>
                        <li>Use your notebook to track cards you've seen</li>
                        <li>Process of elimination helps narrow suspects</li>
                        <li>Watch other players' suggestions carefully</li>
                        <li>The solution cards are never in any player's hand</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="disproval-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üÉè Disprove Suggestion</h3>
                    <button class="close-btn" onclick="closeModal('disproval-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="disproval-form">
                        <p id="disproval-message">You can disprove this suggestion!</p>
                        <div class="form-group">
                            <label>Choose which card to show:</label>
                            <div id="disproval-cards"></div>
                        </div>
                        <button class="btn" onclick="makeDisproval()">Show Card</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="move-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üö∂ Move to Room</h3>
                    <button class="close-btn" onclick="closeModal('move-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="move-form">
                        <div class="form-group">
                            <label>Select Room:</label>
                            <select id="move-room">
                                <option value="">Choose room...</option>
                            </select>
                        </div>
                        <button class="btn" onclick="makeMove()">Move to Room</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="suggestion-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üí° Make Suggestion</h3>
                    <button class="close-btn" onclick="closeModal('suggestion-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="suggestion-form">
                        <div class="form-group">
                            <label>Suspect:</label>
                            <select id="suggest-suspect">
                                <option value="">Choose suspect...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Weapon:</label>
                            <select id="suggest-weapon">
                                <option value="">Choose weapon...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Room:</label>
                            <select id="suggest-room">
                                <option value="">Choose room...</option>
                            </select>
                        </div>
                        <button class="btn" onclick="makeSuggestion()">Make Suggestion</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="accusation-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚öñÔ∏è Make Accusation</h3>
                    <button class="close-btn" onclick="closeModal('accusation-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="accusation-form">
                        <p><strong>‚ö†Ô∏è Warning:</strong> Wrong accusation means you lose the game!</p>
                        <div class="form-group">
                            <label>Suspect:</label>
                            <select id="accuse-suspect">
                                <option value="">Choose suspect...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Weapon:</label>
                            <select id="accuse-weapon">
                                <option value="">Choose weapon...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Room:</label>
                            <select id="accuse-room">
                                <option value="">Choose room...</option>
                            </select>
                        </div>
                        <button class="btn" onclick="makeAccusation()">Make Final Accusation</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="notebook-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üìì Detective Notebook</h3>
                    <button class="close-btn" onclick="closeModal('notebook-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="notebook-content">
                        <h4>üìì Detective's Checklist</h4>
                        <div id="my-cards">Loading...</div>
                        
                        <h4>Notes:</h4>
                        <textarea id="notes-area" placeholder="Enter your detective notes here..." rows="8"></textarea>
                        
                        <button class="btn" onclick="saveNotes()">Save Notes</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="players-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üë• Players</h3>
                    <button class="close-btn" onclick="closeModal('players-modal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="players-content">
                        Loading players...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer-controls">
            <button class="quick-btn" onclick="returnToMenu()">üè† Main Menu</button>
            <button class="quick-btn" onclick="saveGame()">üíæ Save Game</button>
            <button class="quick-btn" onclick="showLoadGame()">üìÇ Load Game</button>
            <button class="quick-btn" onclick="showRules()">üìñ Help</button>
        </div>
    </div>

    <script>
        let currentGameId = null;
        
        // Initialize game on load
        window.onload = function() {
            // Show main menu first
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('game-interface').style.display = 'none';
        };
        
        function startNewGame() {
            const playerCount = document.getElementById('player-count').value;
            const difficulty = document.getElementById('difficulty').value;
            
            // Hide menu and show game
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-interface').style.display = 'block';
            
            // Create new game with selected options
            createNewGameWithOptions(playerCount, difficulty);
        }
        
        function createNewGameWithOptions(playerCount, difficulty) {
            fetch('/api/new_game', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    num_ai: parseInt(playerCount) - 1,
                    difficulty: difficulty
                })
            })
            .then(response => response.json())
            .then(data => {
                currentGameId = data.game_id;
                document.getElementById('game-id').textContent = currentGameId;
                document.getElementById('current-version').textContent = data.version;
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                updateGameInfo(data);
            })
            .catch(error => {
                updateOutput('Error creating game: ' + error.message);
            });
        }
        
        async function newGame() {
            try {
                const response = await fetch('/api/new_game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();
                
                currentGameId = data.game_id;
                document.getElementById('game-id').textContent = data.game_id;
                document.getElementById('current-version').textContent = data.version;
                updateOutput(data.output);
                
                showMessage('New game started!', 'success');
            } catch (error) {
                showMessage('Error starting game', 'error');
            }
        }
        
        async function sendCommand(command) {
            if (!command) return;
            
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: command
                    })
                });
                
                const data = await response.json();
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                updateGameInfo(data);
                
                // Check if waiting for disproval
                if (data.waiting_for_disproval && data.suggestion && data.available_cards) {
                    showDisproval(data.suggestion, data.available_cards);
                }
                
            } catch (error) {
                showMessage('Error sending command', 'error');
            }
        }
        
        function updateOutput(output) {
            const outputDiv = document.getElementById('game-output');
            outputDiv.innerHTML = output;
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        function updateTurnStatus(playerTurn) {
            const status = document.getElementById('turn-status');
            status.textContent = playerTurn ? 'Your Turn' : 'AI Turn';
            status.style.color = playerTurn ? '#00FF00' : '#FFA500';
        }
        
        function updateGameInfo(data) {
            // Update location if available
            if (data.location) {
                document.getElementById('location').textContent = data.location;
            }
        }
        
        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showMap() {
            showModal('map-modal');
            loadMapContent();
        }
        
        function showRules() {
            showModal('rules-modal');
        }
        
        function showNotebook() {
            showModal('notebook-modal');
            loadNotebookContent();
        }
        
        function returnToMenu() {
            // Hide game interface and show main menu
            document.getElementById('game-interface').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
        
        function showLoadGame() {
            // Show list of saved games
            const savedGames = Object.keys(localStorage).filter(key => key.startsWith('clue-game-'));
            
            if (savedGames.length === 0) {
                alert('No saved games found. Save a game first!');
                return;
            }
            
            let gameListHtml = '<div class="game-list">';
            
            savedGames.forEach(gameKey => {
                const gameData = JSON.parse(localStorage.getItem(gameKey));
                const gameId = gameKey.replace('clue-game-', '');
                const playerCount = gameData.num_ai + 1;
                const timestamp = new Date(gameData.timestamp).toLocaleString();
                
                gameListHtml += `
                    <div class="game-item">
                        <div class="game-info">
                            <strong>Game ${gameId}</strong><br>
                            Players: ${playerCount}<br>
                            Saved: ${timestamp}
                        </div>
                        <div class="game-actions">
                            <button class="load-btn" onclick="loadSpecificGame('${gameId}')">Load</button>
                            <button class="delete-btn" onclick="deleteGame('${gameId}')">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            });
            
            gameListHtml += '</div>';
            gameListHtml += '<button class="cancel-btn" onclick="closeLoadModal()">Cancel</button>';
            
            // Create and show modal directly
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = 'load-modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>üìÇ Load Saved Game</h3>
                        <button class="close-btn" onclick="closeLoadModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        ${gameListHtml}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeLoadModal() {
            const modal = document.getElementById('load-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function deleteGame(gameId) {
            if (confirm(`Are you sure you want to delete Game ${gameId}? This cannot be undone!`)) {
                localStorage.removeItem(`clue-game-${gameId}`);
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #FF4444;
                    color: #FFFFFF;
                    padding: 10px 20px;
                    border-radius: 5px;
                    font-weight: bold;
                    z-index: 9999;
                    animation: fadeOut 2s forwards;
                `;
                successMsg.textContent = `üóëÔ∏è Game ${gameId} deleted!`;
                document.body.appendChild(successMsg);
                
                // Remove message after 2 seconds
                setTimeout(() => {
                    if (successMsg.parentNode) {
                        successMsg.parentNode.removeChild(successMsg);
                    }
                }, 2000);
                
                // Refresh the load game modal
                closeModal('load-modal');
                showLoadGame();
            }
        }
        
        function loadSpecificGame(gameId) {
            const gameData = localStorage.getItem(`clue-game-${gameId}`);
            
            if (!gameData) {
                alert('Game data not found!');
                return;
            }
            
            const parsedData = JSON.parse(gameData);
            currentGameId = gameId;
            
            // Hide menu and show game
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-interface').style.display = 'block';
            
            // Update UI with loaded game data
            document.getElementById('game-id').textContent = gameId;
            updateOutput(parsedData.output || 'Game loaded');
            updateTurnStatus(parsedData.player_turn);
            updateGameInfo(parsedData);
            
            // Close modal
            closeLoadModal();
        }
        
        function showPlayers() {
            showModal('players-modal');
            loadPlayersContent();
        }
        
        async function loadMapContent() {
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: 'map'
                    })
                });
                
                const data = await response.json();
                if (data.error) {
                    document.getElementById('map-content').innerHTML = `Error: ${data.error}`;
                } else {
                    document.getElementById('map-content').innerHTML = `<pre>${data.output}</pre>`;
                }
            } catch (error) {
                console.error('Map error:', error);
                document.getElementById('map-content').innerHTML = 'Error loading map: ' + error.message;
            }
        }
        
        async function loadNotebookContent() {
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: 'notebook'
                    })
                });
                
                const data = await response.json();
                if (data.error) {
                    document.getElementById('notebook-content').innerHTML = `Error: ${data.error}`;
                } else {
                    document.getElementById('my-cards').innerHTML = data.output;
                    // populateChecklist(); // Manual checklist removed - using Detective's Checklist instead
                    
                    // Load saved notes if any
                    const savedNotes = localStorage.getItem(`clue-notes-${currentGameId}`);
                    if (savedNotes) {
                        document.getElementById('notes-area').value = savedNotes;
                    }
                }
            } catch (error) {
                console.error('Notebook error:', error);
                document.getElementById('notebook-content').innerHTML = 'Error loading notebook: ' + error.message;
            }
        }
        
        function populateChecklist() {
            const suspects = ["Miss Scarlet", "Col. Mustard", "Mrs. White", "Mr. Green", "Mrs. Peacock", "Prof. Plum"];
            const weapons = ["Candlestick", "Knife", "Lead Pipe", "Revolver", "Rope", "Wrench"];
            const rooms = ["Kitchen", "Ballroom", "Conservatory", "Billiard Room", "Library", "Study", "Hall", "Lounge", "Dining Room"];
            
            // Populate suspect checklist
            const suspectDiv = document.getElementById('suspect-checklist');
            suspectDiv.innerHTML = '';
            suspects.forEach(suspect => {
                const item = document.createElement('div');
                item.className = 'checklist-item';
                item.innerHTML = `
                    <input type="checkbox" id="suspect-${suspect.replace(/\s+/g, '-').replace('.', '')}" onchange="saveChecklist()">
                    <label for="suspect-${suspect.replace(/\s+/g, '-').replace('.', '')}" class="suspect">${suspect}</label>
                `;
                suspectDiv.appendChild(item);
            });
            
            // Populate weapon checklist
            const weaponDiv = document.getElementById('weapon-checklist');
            weaponDiv.innerHTML = '';
            weapons.forEach(weapon => {
                const item = document.createElement('div');
                item.className = 'checklist-item';
                item.innerHTML = `
                    <input type="checkbox" id="weapon-${weapon.replace(/\s+/g, '-')}" onchange="saveChecklist()">
                    <label for="weapon-${weapon.replace(/\s+/g, '-')}" class="weapon">${weapon}</label>
                `;
                weaponDiv.appendChild(item);
            });
            
            // Populate room checklist
            const roomDiv = document.getElementById('room-checklist');
            roomDiv.innerHTML = '';
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'checklist-item';
                item.innerHTML = `
                    <input type="checkbox" id="room-${room.replace(/\s+/g, '-')}" onchange="saveChecklist()">
                    <label for="room-${room.replace(/\s+/g, '-')}" class="room">${room}</label>
                `;
                roomDiv.appendChild(item);
            });
            
            // Load saved checklist state
            loadChecklist();
        }
        
        function saveChecklist() {
            const checklistData = {};
            document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                checklistData[checkbox.id] = checkbox.checked;
            });
            localStorage.setItem(`clue-checklist-${currentGameId}`, JSON.stringify(checklistData));
        }
        
        function loadChecklist() {
            const saved = localStorage.getItem(`clue-checklist-${currentGameId}`);
            if (saved) {
                const checklistData = JSON.parse(saved);
                document.querySelectorAll('.checklist-item input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = checklistData[checkbox.id] || false;
                });
            }
        }
        
        async function loadPlayersContent() {
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: 'players'
                    })
                });
                
                const data = await response.json();
                if (data.error) {
                    document.getElementById('players-content').innerHTML = `Error: ${data.error}`;
                } else {
                    document.getElementById('players-content').innerHTML = data.output;
                }
            } catch (error) {
                console.error('Players error:', error);
                document.getElementById('players-content').innerHTML = 'Error loading players: ' + error.message;
            }
        }
        
        function showDisproval(suggestion, availableCards) {
            // Store current suggestion for later use
            window.currentSuggestion = suggestion;
            window.currentDisprovalCards = availableCards;
            
            // Update modal content
            const message = document.getElementById('disproval-message');
            message.textContent = `${suggestion.player} suggests: ${suggestion.suspect} with ${suggestion.weapon} in ${suggestion.room}`;
            
            // Create card options
            const cardsDiv = document.getElementById('disproval-cards');
            cardsDiv.innerHTML = '';
            
            availableCards.forEach(card => {
                const cardType = getCardType(card);
                const optionDiv = document.createElement('div');
                optionDiv.className = `disproval-card-option ${cardType}`;
                optionDiv.innerHTML = `
                    <input type="radio" name="disproval-card" value="${card}" id="card-${card.replace(/\s+/g, '-')}">
                    <label for="card-${card.replace(/\s+/g, '-')}">${card}</label>
                `;
                cardsDiv.appendChild(optionDiv);
            });
            
            // Show modal
            showModal('disproval-modal');
        }
        
        function getCardType(card) {
            const suspects = ["Miss Scarlet", "Col. Mustard", "Mrs. White", "Mr. Green", "Mrs. Peacock", "Prof. Plum"];
            const weapons = ["Candlestick", "Knife", "Lead Pipe", "Revolver", "Rope", "Wrench"];
            
            if (suspects.includes(card)) return 'suspect';
            if (weapons.includes(card)) return 'weapon';
            return 'room';
        }
        
        async function makeDisproval() {
            const selectedCard = document.querySelector('input[name="disproval-card"]:checked');
            
            if (!selectedCard) {
                alert('Please select a card to show');
                return;
            }
            
            const card = selectedCard.value;
            
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: `disprove ${card}`
                    })
                });
                
                const data = await response.json();
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                closeModal('disproval-modal');
                
            } catch (error) {
                alert('Error making disproval: ' + error.message);
            }
        }
        
        function showMove() {
            showModal('move-modal');
            loadAvailableRooms();
        }
        
        async function loadAvailableRooms() {
            // Get available rooms from game API
            try {
                const response = await fetch('/api/game_info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId
                    })
                });
                
                const data = await response.json();
                
                if (data.available_moves && data.available_moves.length > 0) {
                    const moveSelect = document.getElementById('move-room');
                    moveSelect.innerHTML = '<option value="">Choose room...</option>';
                    data.available_moves.forEach(room => {
                        moveSelect.innerHTML += `<option value="${room}">${room}</option>`;
                    });
                    console.log('Available rooms:', data.available_moves);
                } else {
                    console.log('No available moves found');
                    const moveSelect = document.getElementById('move-room');
                    moveSelect.innerHTML = '<option value="">No moves available</option>';
                }
            } catch (error) {
                console.error('Error loading rooms:', error);
                // Fallback to all rooms
                const rooms = ["Kitchen", "Ballroom", "Conservatory", "Billiard Room", "Library", "Study", "Hall", "Lounge", "Dining Room"];
                const moveSelect = document.getElementById('move-room');
                moveSelect.innerHTML = '<option value="">Choose room...</option>';
                rooms.forEach(room => {
                    moveSelect.innerHTML += `<option value="${room}">${room}</option>`;
                });
            }
        }
        
        async function makeMove() {
            const room = document.getElementById('move-room').value;
            
            if (!room) {
                alert('Please select a room to move to');
                return;
            }
            
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: `move to ${room}`
                    })
                });
                
                const data = await response.json();
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                closeModal('move-modal');
                
            } catch (error) {
                alert('Error moving: ' + error.message);
            }
        }
        
        function showSuggestion() {
            showModal('suggestion-modal');
            populateDropdowns();
        }
        
        function showAccusation() {
            showModal('accusation-modal');
            populateDropdowns();
        }
        
        async function populateDropdowns() {
            // Get current game info
            try {
                const response = await fetch('/api/game_info', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId
                    })
                });
                
                const gameData = await response.json();
                
                // Populate suspect dropdowns
                const suspects = ["Miss Scarlet", "Col. Mustard", "Mrs. White", "Mr. Green", "Mrs. Peacock", "Prof. Plum"];
                const weapons = ["Candlestick", "Knife", "Lead Pipe", "Revolver", "Rope", "Wrench"];
                
                // Clear and populate suspect dropdowns
                ['suggest-suspect', 'accuse-suspect'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Choose suspect...</option>';
                    suspects.forEach(s => {
                        select.innerHTML += `<option value="${s}">${s}</option>`;
                    });
                });
                
                // Clear and populate weapon dropdowns
                ['suggest-weapon', 'accuse-weapon'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Choose weapon...</option>';
                    weapons.forEach(w => {
                        select.innerHTML += `<option value="${w}">${w}</option>`;
                    });
                });
                
                // For suggestion: only show current room
                const suggestRoomSelect = document.getElementById('suggest-room');
                suggestRoomSelect.innerHTML = `<option value="${gameData.current_location}">${gameData.current_location}</option>`;
                suggestRoomSelect.value = gameData.current_location;
                
                // For accusation: show all rooms
                const rooms = ["Kitchen", "Ballroom", "Conservatory", "Billiard Room", "Library", "Study", "Hall", "Lounge", "Dining Room"];
                const accuseRoomSelect = document.getElementById('accuse-room');
                accuseRoomSelect.innerHTML = '<option value="">Choose room...</option>';
                rooms.forEach(r => {
                    accuseRoomSelect.innerHTML += `<option value="${r}">${r}</option>`;
                });
                
            } catch (error) {
                console.error('Error populating dropdowns:', error);
                // Fallback to original behavior
                const suspects = ["Miss Scarlet", "Col. Mustard", "Mrs. White", "Mr. Green", "Mrs. Peacock", "Prof. Plum"];
                const weapons = ["Candlestick", "Knife", "Lead Pipe", "Revolver", "Rope", "Wrench"];
                const rooms = ["Kitchen", "Ballroom", "Conservatory", "Billiard Room", "Library", "Study", "Hall", "Lounge", "Dining Room"];
                
                ['suggest-suspect', 'accuse-suspect'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Choose suspect...</option>';
                    suspects.forEach(s => {
                        select.innerHTML += `<option value="${s}">${s}</option>`;
                    });
                });
                
                ['suggest-weapon', 'accuse-weapon'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Choose weapon...</option>';
                    weapons.forEach(w => {
                        select.innerHTML += `<option value="${w}">${w}</option>`;
                    });
                });
                
                ['suggest-room', 'accuse-room'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">Choose room...</option>';
                    rooms.forEach(r => {
                        select.innerHTML += `<option value="${r}">${r}</option>`;
                    });
                });
            }
        }
        
        async function makeSuggestion() {
            const suspect = document.getElementById('suggest-suspect').value;
            const weapon = document.getElementById('suggest-weapon').value;
            const room = document.getElementById('suggest-room').value;
            
            if (!suspect || !weapon || !room) {
                alert('Please select suspect, weapon, and room');
                return;
            }
            
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: `suggest ${suspect} with ${weapon} in ${room}`
                    })
                });
                
                const data = await response.json();
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                closeModal('suggestion-modal');
                
            } catch (error) {
                alert('Error making suggestion: ' + error.message);
            }
        }
        
        async function makeAccusation() {
            const suspect = document.getElementById('accuse-suspect').value;
            const weapon = document.getElementById('accuse-weapon').value;
            const room = document.getElementById('accuse-room').value;
            
            if (!suspect || !weapon || !room) {
                alert('Please select suspect, weapon, and room');
                return;
            }
            
            if (!confirm(`Are you sure you want to accuse ${suspect} with the ${weapon} in the ${room}?\n\nWrong accusation means you lose the game!`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_id: currentGameId,
                        command: `accuse ${suspect} with ${weapon} in ${room}`
                    })
                });
                
                const data = await response.json();
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                closeModal('accusation-modal');
                
            } catch (error) {
                alert('Error making accusation: ' + error.message);
            }
        }
        
        async function saveGame() {
            if (!currentGameId) {
                alert('No game to save!');
                return;
            }
            
            try {
                // Get current game state
                const outputDiv = document.getElementById('game-output');
                const turnStatus = document.getElementById('turn-status').textContent;
                const location = document.getElementById('location').textContent;
                
                // Save to localStorage
                const gameData = {
                    game_id: currentGameId,
                    output: outputDiv.innerHTML,
                    player_turn: turnStatus,
                    location: location,
                    timestamp: new Date().toISOString(),
                    num_ai: parseInt(document.getElementById('game-id').textContent.split('-')[0]) || 2
                };
                
                localStorage.setItem(`clue-game-${currentGameId}`, JSON.stringify(gameData));
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #00FF00;
                    color: #000;
                    padding: 10px 20px;
                    border-radius: 5px;
                    font-weight: bold;
                    z-index: 9999;
                    animation: fadeOut 2s forwards;
                `;
                successMsg.textContent = `‚úÖ Game ${currentGameId} saved!`;
                document.body.appendChild(successMsg);
                
                // Remove message after 2 seconds
                setTimeout(() => {
                    if (successMsg.parentNode) {
                        successMsg.parentNode.removeChild(successMsg);
                    }
                }, 2000);
                
            } catch (error) {
                alert('Error saving game: ' + error.message);
            }
        }
        
        async function loadGame() {
            const gameId = prompt('Enter Game ID:');
            if (!gameId) return;
            
            try {
                const response = await fetch('/api/load_game', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({game_id: gameId})
                });
                
                const data = await response.json();
                if (data.error) {
                    showMessage(data.error, 'error');
                    return;
                }
                
                currentGameId = data.game_id;
                document.getElementById('game-id').textContent = data.game_id;
                updateOutput(data.output);
                updateTurnStatus(data.player_turn);
                showMessage('Game loaded!', 'success');
                
            } catch (error) {
                showMessage('Error loading game', 'error');
            }
        }
        
        function saveNotes() {
            const notes = document.getElementById('notes-area').value;
            localStorage.setItem(`clue-notes-${currentGameId}`, notes);
            showMessage('Notes saved!', 'success');
        }
    </script>
</body>
</html>
